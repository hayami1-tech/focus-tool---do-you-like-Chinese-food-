<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zao Tai Hearth - 柴火灶番茄钟</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
            background-color: #f3eee3;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        @keyframes smoke {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 0.2; transform: translateY(-100px) scale(1.5); }
            100% { transform: translateY(-200px) scale(2); opacity: 0; }
        }
        .smoke-particle { animation: smoke 5s infinite ease-out; position: absolute; }
        .fire-flicker { animation: flicker 2s infinite alternate ease-in-out; }
        @keyframes flicker {
            0% { transform: scale(0.95); opacity: 0.7; filter: blur(2px); }
            100% { transform: scale(1.05); opacity: 1; filter: blur(1px); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        function App() {
            // 关键：从本地存储读取时间，如果没有则默认为 25 分钟（1500秒）
            const [seconds, setSeconds] = useState(() => {
                const saved = localStorage.getItem('focusTime');
                return saved ? parseInt(saved) : 1500;
            });
            const [isActive, setIsActive] = useState(false);

            // 每次秒数变化时，自动存入浏览器缓存
            useEffect(() => {
                localStorage.setItem('focusTime', seconds);
            }, [seconds]);

            useEffect(() => {
                let interval = null;
                if (isActive && seconds > 0) {
                    interval = setInterval(() => {
                        setSeconds(s => s - 1);
                    }, 1000);
                } else {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isActive, seconds]);

            const formatTime = (s) => {
                const mins = Math.floor(s / 60);
                const secs = s % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            return React.createElement('div', { className: 'min-h-screen flex flex-col items-center justify-center p-4 text-stone-800' },
                React.createElement('h1', { className: 'text-3xl font-light mb-8' }, '柴火灶 - 开启专注当下的时间'),
                
                // 模拟灶台和火焰
                React.createElement('div', { className: 'relative w-64 h-64 bg-stone-300 rounded-t-3xl border-b-8 border-stone-500 flex items-end justify-center' },
                    isActive && React.createElement('div', { className: 'fire-flicker w-20 h-28 bg-orange-500 rounded-full blur-xl mb-4' }),
                    React.createElement('div', { className: 'absolute -top-10 w-4 h-12 bg-stone-400' }, // 烟囱
                        isActive && [1,2,3].map(i => React.createElement('div', { key: i, className: 'smoke-particle w-8 h-8 bg-stone-400 rounded-full blur-md', style: { animationDelay: `${i*1.5}s` } }))
                    )
                ),

                React.createElement('div', { className: 'text-6xl font-mono my-10' }, formatTime(seconds)),
                
                React.createElement('div', { className: 'space-x-4' },
                    React.createElement('button', { 
                        onClick: () => setIsActive(!isActive),
                        className: 'px-8 py-2 bg-stone-800 text-white rounded-full hover:bg-stone-700 transition'
                    }, isActive ? '暂缓' : '点火'),
                    React.createElement('button', { 
                        onClick: () => { setIsActive(false); setSeconds(1500); },
                        className: 'px-8 py-2 border border-stone-800 rounded-full'
                    }, '重置')
                ),

                React.createElement('p', { className: 'mt-12 text-stone-500 italic max-w-md text-center' }, 
                    '“当我想起中国食物时，我会想起外婆监督我做作业的童年。和我一起回到那个没有手机，没有AI，没有移动互联网的时代。”'
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
